<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="Archive — WOOHWAHAE. 인문학적 사유와 감각에서 파생된 기록을 축적하는 곳.">
  <meta property="og:title" content="Archive — WOOHWAHAE">
  <meta property="og:description" content="인문학적 사유와 감각에서 파생된 기록을 축적하는 곳.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://woohwahae.kr/archive/">
  <meta property="og:image" content="https://woohwahae.kr/assets/img/symbol.jpg">
  <title>Archive — WOOHWAHAE</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#F0EFEB">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="/assets/img/icon-192.png">
  <link rel="icon" href="../assets/img/symbol.png" type="image/svg+xml">
  <link rel="preload" href="../assets/css/style.css?v=renewal_v1" as="style">
  <link rel="stylesheet" href="../assets/css/style.css?v=renewal_v1">
  <script src="../assets/js/analytics.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
</head>

<body class="home-radical">

  <canvas id="field-bg" class="field-bg-canvas"></canvas>

  <nav>
    <a href="/" class="nav-logo">
      <img src="../assets/img/symbol.png" class="nav-symbol" alt="WOOHWAHAE">
    </a>
    <ul class="nav-links">
      <li><a href="../archive/" class="active">Archive</a></li>
      <li><a href="../offering.html">Offering</a></li>
      <li><a href="../about.html">About</a></li>
      <li><a href="../contact.html">Contact</a></li>
      <li><a href="../lab/">Lab</a></li>
    </ul>
    <button class="nav-lang-toggle" id="lang-toggle" aria-label="Toggle Language">EN</button>
    <button class="nav-toggle" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </nav>

  <main class="container--wide">

    <!-- Archive Header -->
    <div class="arc-header fade-in">
      <p class="section-label">Archive</p>
    </div>

    <!-- Filter -->
    <div class="arc-filter-bar fade-in" id="archive-filters">
      <button class="arc-filter active" data-filter="all">All</button>
      <button class="arc-filter" data-filter="essay">Essay</button>
      <button class="arc-filter" data-filter="journal">Journal</button>
    </div>

    <!-- Featured Block -->
    <div class="arc-featured" id="arc-featured" style="display:none">
      <div class="arc-featured-meta">
        <span class="arc-featured-issue" id="feat-issue"></span>
        <span class="arc-featured-cat" id="feat-cat"></span>
        <span class="arc-featured-date" id="feat-date"></span>
        <span class="arc-featured-read" id="feat-read"></span>
      </div>
      <a class="arc-featured-link" id="feat-link" href="#">
        <h2 class="arc-featured-title" id="feat-title"></h2>
        <p class="arc-featured-preview" id="feat-preview"></p>
        <span class="arc-featured-cta">읽기 →</span>
      </a>
    </div>

    <!-- 목차 리스트 -->
    <div class="arc-divider"></div>
    <div class="arc-list" id="archive-list"></div>
    <div class="arc-divider"></div>

    <p id="archive-empty" class="arc-empty" style="display:none;">해당하는 기록이 없습니다.</p>

  </main>

  <footer class="section--light">
    <div class="footer-inner">
      <div class="footer-brand-row">
        <p class="footer-brand-name">WOOHWAHAE</p>
      </div>
      <div class="footer-nav-row">
        <a href="../archive/">Archive</a>
        <a href="../offering.html">Offering</a>
        <a href="../about.html">About</a>
        <a href="../contact.html">Contact</a>
        <a href="../lab/">Lab</a>
      </div>
      <div class="footer-connect-row">
        <a href="https://instagram.com/woohwahae" target="_blank" rel="noopener">@woohwahae</a>
        <a href="https://instagram.com/woosunhokr" target="_blank" rel="noopener">@woosunhokr</a>
        <a href="https://map.naver.com/p/entry/place/1017153611?lng=129.3497445&lat=35.5592547&placePath=/stylist" target="_blank" rel="noopener">Booking</a>
        <a href="mailto:hello@woohwahae.kr">Email</a>
      </div>
      <div class="footer-bottom">
        <p class="footer-bottom-copy">&copy; 2024 WOOHWAHAE. All rights reserved.</p>
        <div class="footer-legal">
          <a href="../privacy.html">Privacy</a>
          <a href="../terms.html">Terms</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="../assets/js/main.js"></script>
  <script>
    (function () {
      var list = document.getElementById('archive-list');
      var emptyMsg = document.getElementById('archive-empty');
      var filtersEl = document.getElementById('archive-filters');
      var posts = [];
      var activeFilter = 'all';

      fetch('index.json')
        .then(function (r) { return r.json(); })
        .then(function (data) {
          posts = data;
          render();
          bindEvents();
        })
        .catch(function () {
          list.innerHTML = '<p class="arc-empty">아카이브를 불러오지 못했습니다.</p>';
        });

      function renderFeatured() {
        if (!posts || posts.length === 0) return;
        var p = posts[0];
        var featuredEl = document.getElementById('arc-featured');
        document.getElementById('feat-issue').textContent = p.issue || '';
        document.getElementById('feat-cat').textContent = p.category ? p.category.toUpperCase() : '';
        document.getElementById('feat-date').textContent = p.date || '';
        document.getElementById('feat-read').textContent = p.readMin ? p.readMin + ' min' : '';
        document.getElementById('feat-title').textContent = p.title || '';
        document.getElementById('feat-preview').textContent = p.preview || '';
        document.getElementById('feat-link').href = p.slug + '/';
        featuredEl.style.display = 'block';
      }

      function render() {
        /* Featured: 항상 posts[0] 고정 (필터 무관) */
        renderFeatured();

        /* 목록: featured(posts[0])를 제외한 나머지 + 필터 적용 */
        var filtered = posts.slice(1).filter(function (p) {
          return activeFilter === 'all' || p.category.toLowerCase() === activeFilter;
        });

        list.innerHTML = '';

        if (filtered.length === 0) {
          emptyMsg.style.display = 'block';
        } else {
          emptyMsg.style.display = 'none';
        }

        filtered.forEach(function (post, idx) {
          var issueNum = post.issue ? post.issue.replace('Issue ', '').replace('Issue', '').trim() : '00';
          var row = document.createElement('a');
          row.href = post.slug + '/';
          row.className = 'arc-row';
          row.setAttribute('data-index', idx);

          row.innerHTML =
            '<span class="arc-row-num">' + issueNum.padStart(3, '0') + '</span>' +
            '<span class="arc-row-title">' + post.title + '</span>' +
            '<span class="arc-row-date">' + post.date + '</span>' +
            '<span class="arc-row-cat">' + post.category.toUpperCase() + '</span>';

          list.appendChild(row);
        });

        /* slide-in observer with staggered delay */
        list.querySelectorAll('.arc-row').forEach(function (el) {
          var obs = new IntersectionObserver(function (entries) {
            if (entries[0].isIntersecting) {
              var delay = parseInt(el.getAttribute('data-index'), 10) * 0.05;
              el.style.transitionDelay = delay + 's';
              el.classList.add('visible');
              obs.unobserve(entries[0].target);
            }
          }, { threshold: 0.05 });
          obs.observe(el);
        });
      }

      function bindEvents() {
        filtersEl.addEventListener('click', function (e) {
          if (!e.target.classList.contains('arc-filter')) return;
          filtersEl.querySelectorAll('.arc-filter').forEach(function (b) {
            b.classList.remove('active');
          });
          e.target.classList.add('active');
          activeFilter = e.target.dataset.filter;
          render();
        });
      }
    })();

    /* ── Three.js dipole field background (full-page) ── */
    (function () {
      var canvas = document.getElementById('field-bg');
      if (!canvas || typeof THREE === 'undefined') return;
      var renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setClearColor(0x000000, 0);
      var scene = new THREE.Scene();
      var fieldGroup = new THREE.Group();
      scene.add(fieldGroup);
      var camera = new THREE.PerspectiveCamera(50, 1, 0.1, 1000);
      camera.position.set(0, 1.5, 18);
      camera.lookAt(0, 0, 0);
      var LINE_COUNT = 10; var SEEDS = 6; var POINTS_PER = 160; var MAX_R = 12.0; var SCALE = 3.0;
      function buildFieldLine(r0, phi) {
        var pts = new Float32Array(POINTS_PER * 3);
        var baseZ = new Float32Array(POINTS_PER);
        var tMin = 0.04, tMax = Math.PI - 0.04;
        for (var i = 0; i < POINTS_PER; i++) {
          var theta = tMin + (i / (POINTS_PER - 1)) * (tMax - tMin);
          var sinT = Math.sin(theta), cosT = Math.cos(theta);
          var r = r0 * sinT * sinT; if (r > MAX_R) r = MAX_R;
          pts[i*3] = r*sinT*Math.cos(phi)*SCALE;
          pts[i*3+1] = r*cosT*SCALE;
          pts[i*3+2] = r*sinT*Math.sin(phi)*SCALE;
          baseZ[i] = pts[i*3+2];
        }
        return { pts: pts, baseZ: baseZ };
      }
      var fieldLines = [];
      var seeds = [];
      for (var si = 0; si < SEEDS; si++) seeds.push(0.8 + Math.pow((si+1)/SEEDS, 1.8) * 11.0);
      for (var li = 0; li < LINE_COUNT; li++) {
        var phi = (li / LINE_COUNT) * Math.PI * 2;
        for (var si2 = 0; si2 < SEEDS; si2++) {
          var r0 = seeds[si2]; var frac = (si2+1)/SEEDS;
          var baseOp = 0.65 - frac * 0.3;
          var col = frac < 0.5 ? 0x1a1a1a : 0x1B2D4F;
          var mat = new THREE.LineBasicMaterial({ color: col, opacity: baseOp, transparent: true });
          var built = buildFieldLine(r0, phi);
          var geo = new THREE.BufferGeometry();
          geo.setAttribute('position', new THREE.BufferAttribute(built.pts, 3));
          fieldGroup.add(new THREE.Line(geo, mat));
          fieldLines.push({ mat: mat, baseOp: baseOp, phase: li*(Math.PI*2/LINE_COUNT)+si2*0.35, geo: geo, pts: built.pts, baseZ: built.baseZ });
        }
      }
      function onResize() {
        var W = window.innerWidth, H = window.innerHeight;
        renderer.setSize(W, H, false);
        camera.aspect = W / H; camera.updateProjectionMatrix();
      }
      onResize(); window.addEventListener('resize', onResize);
      var clock = new THREE.Clock();
      function animate() {
        requestAnimationFrame(animate);
        var t = clock.getElapsedTime();
        fieldGroup.rotation.y = t * 0.003;
        for (var i = 0; i < fieldLines.length; i++) {
          var fl = fieldLines[i];
          fl.mat.opacity = fl.baseOp * (0.4 + 0.6 * (0.5 + 0.5 * Math.sin(t * 1.0 + fl.phase)));
          var pos = fl.pts;
          for (var p = 0; p < POINTS_PER; p++) {
            var frac2 = p / (POINTS_PER - 1);
            pos[p*3+2] = fl.baseZ[p] + Math.sin(frac2*Math.PI)*0.2*Math.sin(t*0.7+fl.phase+frac2*6.28);
          }
          fl.geo.attributes.position.needsUpdate = true;
        }
        renderer.render(scene, camera);
      }
      animate();
    })();
  </script>

</body>

</html>
