<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="{{issue}} — {{title}}. {{preview}}">
  <meta property="og:title" content="{{issue}}: {{title}} — WOOHWAHAE Archive">
  <meta property="og:description" content="{{preview}}">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://woohwahae.kr/archive/{{slug}}/">
  <meta property="og:image" content="https://woohwahae.kr/assets/media/brand/symbol.jpg">
  <title>{{issue}}: {{title}} — WOOHWAHAE Archive</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#E3E2E0">
  <link rel="icon" href="/assets/media/brand/symbol.png" type="image/png">
  <link rel="apple-touch-icon" href="/assets/media/brand/icon-192.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;1,300&family=IBM+Plex+Mono:ital,wght@0,300;0,400;1,300&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css">
  <link rel="preload" href="/assets/css/style.css?v=tone1" as="style">
  <link rel="stylesheet" href="/assets/css/style.css?v=tone1">
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script>
    (function () { var h = new Date().getHours(); document.documentElement.className = h < 6 ? 'time-dawn' : h < 18 ? 'time-day' : h < 22 ? 'time-evening' : 'time-night'; })();
  </script>
</head>

<body>

  <div class="reading-progress-container">
    <div class="reading-progress-bar" id="reading-progress-bar"></div>
  </div>

  <!-- COMPONENT:nav -->
  <!-- /COMPONENT:nav -->

  <div class="art-progress-side" id="art-progress-side">
    <div class="art-progress-side-fill" id="art-progress-side-fill"></div>
  </div>

  <article class="art">
    <canvas id="art-wave" class="art-wave-canvas"></canvas>
    <div class="art-container">

      <div class="art-back fade-in">
        <a href="/archive/">← Archive</a>
      </div>

      <header class="art-header">
        <div class="art-header-rule fade-in"></div>

        <div class="art-header-grid fade-in">
          <div class="art-header-meta">
            <p class="art-issue">{{issue}}</p>
            <p class="art-date">{{date}}</p>
            <p class="art-readtime" id="read-time"></p>
          </div>
          <div class="art-header-main">
            <p class="art-meta-line fade-in"><span class="art-category-inline">{{category}}</span> · {{issue}} · <span id="read-time-inline"></span></p>
            <h1 class="art-title">{{title}}</h1>
            <p class="art-subtitle">{{preview}}</p>
            <hr class="art-rule">
          </div>
        </div>

        <div class="art-header-rule fade-in"></div>
      </header>

      <div class="art-content-grid">
        <aside class="art-sidebar fade-in">
          <p class="art-sidebar-issue">{{issue}}</p>
          <p class="art-sidebar-cat">{{category}}</p>
        </aside>
        <div class="art-body" id="article-content">
{{content}}
        </div>
      </div>

      <footer class="art-outro fade-in">
        <div class="art-outro-rule"></div>
        <div class="art-outro-meta">
          <span>{{issue}}</span>
          <span>{{date}}</span>
        </div>
        <div class="art-outro-nav">
          {{prev_link}}
          <a href="/archive/" class="art-nav-link">Archive ↑</a>
        </div>
      </footer>

    </div>
  </article>

  <!-- COMPONENT:footer -->
  <!-- /COMPONENT:footer -->

  <nav class="art-float-nav" id="art-float-nav">
    <a class="art-float-prev" href="#" id="art-prev-link">← 이전</a>
    <a class="art-float-next" href="#" id="art-next-link">다음 →</a>
  </nav>

  <script src="/assets/js/site.js" defer></script>
  <script>
    /* 읽기시간 */
    (function () {
      var content = document.getElementById('article-content');
      var rt = document.getElementById('read-time');
      var rtInline = document.getElementById('read-time-inline');
      if (!content) return;
      var words = content.innerText.trim().split(/\s+/).length;
      var mins = Math.max(1, Math.round(words / 200));
      var label = mins + ' min';
      if (rt) rt.textContent = label + ' read';
      if (rtInline) rtInline.textContent = label;
    })();

    /* Reading progress bar (가로 + 세로) */
    (function () {
      var bar = document.getElementById('reading-progress-bar');
      var sideFill = document.getElementById('art-progress-side-fill');
      if (!bar && !sideFill) return;
      function updateProgress() {
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        var docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        var pct = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        if (bar) bar.style.width = pct + '%';
        if (sideFill) sideFill.style.height = pct + '%';
      }
      window.addEventListener('scroll', updateProgress, { passive: true });
    })();

    /* Floating nav — scroll 표시 */
    (function () {
      var floatNav = document.getElementById('art-float-nav');
      if (!floatNav) return;
      window.addEventListener('scroll', function () {
        floatNav.classList.toggle('visible', window.scrollY > 200);
      }, { passive: true });
    })();

    /* Floating nav — prev/next 링크 */
    (function () {
      var pathParts = window.location.pathname.split('/').filter(Boolean);
      var currentSlug = pathParts[pathParts.length - 2] || pathParts[pathParts.length - 1];
      if (!currentSlug) return;
      fetch('/archive/index.json').then(function (r) { return r.json(); }).then(function (posts) {
        var idx = posts.findIndex(function (p) { return p.slug === currentSlug; });
        if (idx === -1) return;
        var prevLink = document.getElementById('art-prev-link');
        var nextLink = document.getElementById('art-next-link');
        if (prevLink && idx < posts.length - 1) {
          prevLink.href = '/archive/' + posts[idx + 1].slug + '/index.html';
          prevLink.textContent = '← ' + posts[idx + 1].issue;
        }
        if (nextLink && idx > 0) {
          nextLink.href = '/archive/' + posts[idx - 1].slug + '/index.html';
          nextLink.textContent = posts[idx - 1].issue + ' →';
        }
      }).catch(function () {});
    })();

    /* Three.js dipole field banner (article header strip) */
    (function () {
      var canvas = document.getElementById('art-wave');
      if (!canvas || typeof THREE === 'undefined') return;
      var renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true, antialias: true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setClearColor(0x000000, 0);
      var scene = new THREE.Scene();
      var fieldGroup = new THREE.Group();
      scene.add(fieldGroup);
      var camera = new THREE.PerspectiveCamera(65, 1, 0.1, 500);
      camera.position.set(0, 1, 10);
      camera.lookAt(0, 0, 0);
      var LINE_COUNT = 6, SEEDS = 4, POINTS_PER = 80, MAX_R = 8.0, SCALE = 1.8;
      function buildFieldLine(r0, phi) {
        var pts = new Float32Array(POINTS_PER * 3);
        var baseZ = new Float32Array(POINTS_PER);
        var tMin = 0.05, tMax = Math.PI - 0.05;
        for (var i = 0; i < POINTS_PER; i++) {
          var theta = tMin + (i / (POINTS_PER - 1)) * (tMax - tMin);
          var sinT = Math.sin(theta), cosT = Math.cos(theta);
          var r = r0 * sinT * sinT; if (r > MAX_R) r = MAX_R;
          pts[i*3] = r*sinT*Math.cos(phi)*SCALE;
          pts[i*3+1] = r*cosT*SCALE;
          pts[i*3+2] = r*sinT*Math.sin(phi)*SCALE;
          baseZ[i] = pts[i*3+2];
        }
        return { pts: pts, baseZ: baseZ };
      }
      var fieldLines = [];
      var seeds = [];
      for (var si = 0; si < SEEDS; si++) seeds.push(0.8 + Math.pow((si+1)/SEEDS, 1.8) * 8.0);
      for (var li = 0; li < LINE_COUNT; li++) {
        var phi = (li / LINE_COUNT) * Math.PI * 2;
        for (var si2 = 0; si2 < SEEDS; si2++) {
          var r0 = seeds[si2]; var frac = (si2+1)/SEEDS;
          var baseOp = 0.45 - frac * 0.2;
          var col = frac < 0.5 ? 0x1a1a1a : 0x1B2D4F;
          var mat = new THREE.LineBasicMaterial({ color: col, opacity: baseOp, transparent: true });
          var built = buildFieldLine(r0, phi);
          var geo = new THREE.BufferGeometry();
          geo.setAttribute('position', new THREE.BufferAttribute(built.pts, 3));
          fieldGroup.add(new THREE.Line(geo, mat));
          fieldLines.push({ mat: mat, baseOp: baseOp, phase: li*(Math.PI*2/LINE_COUNT)+si2*0.35, geo: geo, pts: built.pts, baseZ: built.baseZ });
        }
      }
      function onResize() {
        var W = canvas.offsetWidth, H = canvas.offsetHeight || 100;
        renderer.setSize(W, H, false);
        camera.aspect = W / H; camera.updateProjectionMatrix();
      }
      onResize(); window.addEventListener('resize', onResize);
      var clock = new THREE.Clock();
      function animate() {
        requestAnimationFrame(animate);
        var t = clock.getElapsedTime();
        fieldGroup.rotation.y = t * 0.002;
        for (var i = 0; i < fieldLines.length; i++) {
          var fl = fieldLines[i];
          fl.mat.opacity = fl.baseOp * (0.5 + 0.5 * Math.sin(t * 0.8 + fl.phase));
          var pos = fl.pts;
          for (var p = 0; p < POINTS_PER; p++) {
            var frac2 = p / (POINTS_PER - 1);
            pos[p*3+2] = fl.baseZ[p] + Math.sin(frac2*Math.PI)*0.15*Math.sin(t*0.6+fl.phase+frac2*6.28);
          }
          fl.geo.attributes.position.needsUpdate = true;
        }
        renderer.render(scene, camera);
      }
      animate();
    })();
  </script>

</body>

</html>
