<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="WOOHWAHAE — Archive for Slow Life. 가속화된 세상에서 주체적으로 살아가기 위한 생각과 실천의 아카이브.">
  <meta property="og:title" content="WOOHWAHAE">
  <meta property="og:description" content="Archive for Slow Life">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://woohwahae.kr/">
  <meta property="og:image" content="https://woohwahae.kr/assets/img/symbol.jpg">
  <title>WOOHWAHAE</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#F0EFEB">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="/assets/img/icon-192.png">
  <link rel="icon" href="assets/img/symbol.png" type="image/svg+xml">
  <link rel="preload" href="assets/css/style.css?v=home_v4" as="style">
  <link rel="stylesheet" href="assets/css/style.css?v=home_v4">
  <script src="assets/js/analytics.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
</head>

<body class="home-radical">

  <!-- 전체 페이지 배경 필드 캔버스 — fixed, z=0 -->
  <canvas id="field-bg" class="field-bg-canvas"></canvas>

  <!-- Nav — 최소화, 투명 배경 -->
  <nav class="nav-radical">
    <a href="/" class="nav-logo">
      <img src="assets/img/symbol.png" class="nav-symbol" alt="WOOHWAHAE">
    </a>
    <ul class="nav-links">
      <li><a href="archive/">Archive</a></li>
      <li><a href="offering.html">Offering</a></li>
      <li><a href="about.html">About</a></li>
    </ul>
    <button class="nav-toggle" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </nav>

  <!-- 단일 스크롤 공간 — 섹션 없음, 텍스트 블록만 -->
  <main class="field-main">

    <!-- Block 0: 브랜드 — 화면 중앙 하단 -->
    <div class="fb fb--brand">
      <p class="fb-statement">Archive for Slow Life.</p>
      <p class="fb-brand">WOOHWAHAE</p>
    </div>

    <!-- Block 1: 우화 -->
    <div class="fb fb--uwh">
      <p class="fb-label">우화(羽化)</p>
      <p class="fb-ko">번데기가 나비가 되는 과정.<br>각자의 속도로, 내면의 美를 성찰하며.</p>
    </div>

    <!-- Block 3: 최신 에세이 -->
    <div class="fb fb--essay">
      <a href="#" class="fb-essay-link" id="featured-article">
        <span class="fb-essay-meta">
          <span id="featured-issue">—</span>
          <span class="fb-essay-sep">·</span>
          <span id="featured-date">—</span>
        </span>
        <strong class="fb-essay-title" id="featured-title"></strong>
      </a>
    </div>

    <!-- Block 4: 하단 링크 -->
    <div class="fb fb--nav">
      <a href="archive/">Archive</a>
      <a href="offering.html">Offering</a>
      <a href="about.html">About</a>
    </div>

  </main>

  <!-- Footer -->
  <footer class="section--light">
    <div class="footer-inner">
      <div class="footer-brand-row">
        <p class="footer-brand-name">WOOHWAHAE</p>
      </div>
      <div class="footer-nav-row">
        <a href="archive/">Archive</a>
        <a href="offering.html">Offering</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="lab/">Lab</a>
      </div>
      <div class="footer-connect-row">
        <a href="https://instagram.com/woohwahae" target="_blank" rel="noopener">@woohwahae</a>
        <a href="https://instagram.com/woosunhokr" target="_blank" rel="noopener">@woosunhokr</a>
        <a href="https://map.naver.com/p/entry/place/1017153611?lng=129.3497445&lat=35.5592547&placePath=/stylist" target="_blank" rel="noopener">Booking</a>
        <a href="mailto:hello@woohwahae.kr">Email</a>
      </div>
      <div class="footer-bottom">
        <p class="footer-bottom-copy">&copy; 2024 WOOHWAHAE. All rights reserved.</p>
        <div class="footer-legal">
          <a href="privacy.html">Privacy</a>
          <a href="terms.html">Terms</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="assets/js/main.js"></script>
  <script>
    /* ══════════════════════════════════════════════════════
       FIELD BG — 전체 페이지 배경 쌍극자 자기장 (Three.js)
       스크롤에 따라 극 위치 · 씨앗 · 회전속도 변형
    ══════════════════════════════════════════════════════ */
    (function () {
      var canvas = document.getElementById('field-bg');
      if (!canvas || typeof THREE === 'undefined') return;

      /* ── prefers-reduced-motion: 접근성 — 애니메이션 비활성화 ── */
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        canvas.style.display = 'none';
        return;
      }

      /* ── 모바일 감지 — 렌더 품질 조절 ── */
      var isMobile = window.innerWidth < 768;

      /* ── Renderer ── */
      var renderer = new THREE.WebGLRenderer({
        canvas: canvas,
        alpha: true,
        antialias: !isMobile  /* 모바일: antialias 비활성화로 GPU 부하 감소 */
      });
      renderer.setPixelRatio(isMobile ? 1 : Math.min(window.devicePixelRatio, 2));
      renderer.setClearColor(0x000000, 0);

      /* ── Scene & Camera ── */
      var scene    = new THREE.Scene();
      var fieldGroup = new THREE.Group();  /* 회전 그룹 — 씬에 먼저 등록 */
      scene.add(fieldGroup);

      var camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
      camera.position.set(0, 1.5, 20);
      camera.lookAt(0, 0, 0);

      /* ── 마우스 추적 ── */
      var mouse = { x: 0, y: 0 };
      document.addEventListener('mousemove', function (e) {
        mouse.x = (e.clientX / window.innerWidth  - 0.5) * 2;
        mouse.y = (e.clientY / window.innerHeight - 0.5) * 2;
      });

      /* ── 쌍극자 필드라인 파라미터 — 모바일/데스크탑 분기 ── */
      var LINE_COUNT = isMobile ? 12 : 24;   /* 모바일: φ 슬라이스 절반 */
      var SEEDS      = isMobile ? 5  : 10;   /* 모바일: 씨앗 수 절반 */
      var POINTS_PER = isMobile ? 110 : 220; /* 모바일: 포인트 수 절반 */
      var MAX_R      = 15.0;
      var SCALE      = 2.8;   /* 지질학적 안착감 (3.2 → 2.8) */

      function buildFieldLine(r0, phi) {
        var pts   = new Float32Array(POINTS_PER * 3);
        var baseZ = new Float32Array(POINTS_PER);
        var tMin  = 0.04;
        var tMax  = Math.PI - 0.04;
        for (var i = 0; i < POINTS_PER; i++) {
          var theta = tMin + (i / (POINTS_PER - 1)) * (tMax - tMin);
          var sinT  = Math.sin(theta);
          var cosT  = Math.cos(theta);
          var r     = r0 * sinT * sinT;
          if (r > MAX_R) r = MAX_R;
          pts[i * 3]     = r * sinT * Math.cos(phi) * SCALE;
          pts[i * 3 + 1] = r * cosT * SCALE;
          pts[i * 3 + 2] = r * sinT * Math.sin(phi) * SCALE;
          baseZ[i]       = pts[i * 3 + 2];
        }
        return { pts: pts, baseZ: baseZ };
      }

      var fieldLines = [];

      /* r0 씨앗: 안쪽 조밀, 바깥 성긴 — 중심 수렴감 강화 */
      var seeds = [];
      for (var si = 0; si < SEEDS; si++) {
        seeds.push(0.8 + Math.pow((si + 1) / SEEDS, 1.8) * 11.0);
      }

      for (var li = 0; li < LINE_COUNT; li++) {
        var phi = (li / LINE_COUNT) * Math.PI * 2;
        for (var si2 = 0; si2 < SEEDS; si2++) {
          var r0 = seeds[si2];
          var frac = (si2 + 1) / SEEDS;
          /* 안쪽(소): 진함. 바깥(대): 연함 — 중심 집중감 */
          var baseOp = 0.75 - frac * 0.35;
          /* 색상: 안쪽 다크, 바깥 네이비 — 주파수/에너지 레이어 */
          var col = frac < 0.5 ? 0x1a1a1a : 0x1B2D4F;

          var mat = new THREE.LineBasicMaterial({
            color: col,
            opacity: baseOp,
            transparent: true
          });

          var built = buildFieldLine(r0, phi);
          var geo   = new THREE.BufferGeometry();
          geo.setAttribute('position', new THREE.BufferAttribute(built.pts, 3));
          fieldGroup.add(new THREE.Line(geo, mat));

          fieldLines.push({
            mat:    mat,
            baseOp: baseOp,
            phase:  li * (Math.PI * 2 / LINE_COUNT) + si2 * 0.35,
            geo:    geo,
            pts:    built.pts,
            baseZ:  built.baseZ,
            frac:   frac
          });
        }
      }

      /* ── 중심 극점: 발광 링 3개 (맥동) ── */
      var pulseRings = [];
      [0.18, 0.38, 0.65].forEach(function (r, idx) {
        var segs = 80;
        var pts  = [];
        for (var a = 0; a <= segs; a++) {
          var ang = (a / segs) * Math.PI * 2;
          pts.push(new THREE.Vector3(Math.cos(ang) * r, Math.sin(ang) * r, 0));
        }
        var geo = new THREE.BufferGeometry().setFromPoints(pts);
        var mat = new THREE.LineBasicMaterial({
          color: 0x1a1a1a, opacity: 0.5 - idx * 0.12, transparent: true
        });
        fieldGroup.add(new THREE.Line(geo, mat));
        pulseRings.push({ mat: mat, baseOp: 0.5 - idx * 0.12, phase: idx * 1.2 });
      });

      /* ── 중심 심볼: 나비 로고 텍스처 Plane ── */
      var symbolMesh = null;
      (function () {
        var loader = new THREE.TextureLoader();
        loader.load('assets/img/symbol.png', function (tex) {
          tex.minFilter = THREE.LinearFilter;
          /* 원본 비율 유지 (정사각형 가정, 아니면 PlaneGeometry 비율 조정) */
          var geo = new THREE.PlaneGeometry(0.72, 0.72);
          var mat = new THREE.MeshBasicMaterial({
            map:         tex,
            transparent: true,
            opacity:     0.55,
            depthTest:   false,
            alphaTest:   0.02
          });
          symbolMesh = new THREE.Mesh(geo, mat);
          symbolMesh.renderOrder = 10;  /* 필드선 위에 렌더 */
          fieldGroup.add(symbolMesh);
        });
      })();

      /* ── 리사이즈 ── */
      function onResize() {
        var W = window.innerWidth;
        var H = window.innerHeight;
        renderer.setSize(W, H, false);
        camera.aspect = W / H;
        camera.updateProjectionMatrix();
      }
      onResize();
      window.addEventListener('resize', onResize);

      /* ── 애니메이션 루프 ── */
      var clock   = new THREE.Clock();
      var camX    = 0;
      var camY    = 2;

      function animate() {
        requestAnimationFrame(animate);
        var t = clock.getElapsedTime();

        /* 스크롤 상태 읽기 — _fieldState는 별도 IIFE에서 정의 */
        var sr = (window._fieldState && window._fieldState.ratio) || 0;

        /* 씬 Y축 회전 — 돌의 무거운 자전 (기존 대비 약 60% 감속) */
        var rotSpeed = 0.002 + sr * 0.003;
        fieldGroup.rotation.y = t * rotSpeed;

        /* X축 회전 — 돌의 최소 기울기 (±0.08rad), 느린 lerp */
        fieldGroup.rotation.x += (-mouse.y * 0.08 - fieldGroup.rotation.x) * 0.015;

        /* 카메라 z + FOV — 돌 무게감, 완만한 수렴 + 무거운 관성 */
        var targetZ = 20 - sr * 10;
        camera.position.z += (targetZ - camera.position.z) * 0.015;
        camera.fov += (45 - sr * 9 - camera.fov) * 0.015;
        camera.updateProjectionMatrix();

        /* 각 필드라인: opacity 맥동 + z-wobble */
        for (var i = 0; i < fieldLines.length; i++) {
          var fl = fieldLines[i];

          /* opacity — 완만한 밝기 변화 */
          var waveBase = 0.38 + sr * 0.10;
          var wave     = 0.5 + 0.5 * Math.sin(t * 0.7 + fl.phase);  /* 느린 맥동 (~9s 주기) */
          /* scrollPulse — 중간(sr≈0.5)에서 최고조, 처음/끝에서 약해짐 (0.7~1.0) */
          var scrollPulse = 0.7 + 0.3 * Math.sin(sr * Math.PI);
          fl.mat.opacity = fl.baseOp * scrollPulse * (waveBase + 0.60 * wave);

          /* z-wobble — 돌의 억제된 진동 (진폭 최소화, 느린 지각 호흡 ~7s) */
          var wobbleMax = 0.15 + sr * 0.12;
          var pos = fl.pts;
          for (var p = 0; p < POINTS_PER; p++) {
            var frac = p / (POINTS_PER - 1);
            var amp  = Math.sin(frac * Math.PI) * wobbleMax;
            pos[p * 3 + 2] = fl.baseZ[p] +
              amp * Math.sin(t * 0.9 + fl.phase + frac * 6.2832); /* 느린 호흡 ~7s = 2π/0.9 */
          }
          fl.geo.attributes.position.needsUpdate = true;
        }

        /* 중심 링 맥동 — 돌의 느린 극점 진동 (~3.5s 주기) */
        for (var ri = 0; ri < pulseRings.length; ri++) {
          var ring = pulseRings[ri];
          ring.mat.opacity = ring.baseOp * (0.4 + 0.6 * Math.sin(t * 1.8 + ri * 2.094));
        }

        /* 나비 심볼 — 필드 호흡과 동기화 (느린 맥동) */
        if (symbolMesh) {
          symbolMesh.material.opacity = (0.35 + sr * 0.3) * (0.8 + 0.2 * Math.sin(t * 0.9)); /* 느린 호흡 동기화 */
          /* 필드 그룹 회전에 역방향 보정 — 심볼은 항상 정면을 향함 */
          symbolMesh.rotation.y = -fieldGroup.rotation.y;
        }

        /* 카메라 x/y — 돌의 둔감한 마우스 반응 */
        camX += (mouse.x * 1.2 - camX) * 0.012;
        camY += (1.5 - mouse.y * 1.0 - camY) * 0.012;
        camera.position.x = camX;
        camera.position.y = camY;
        camera.lookAt(0, 0, 0);

        renderer.render(scene, camera);
      }

      animate();
    })();

    /* ─── Scroll → 씬 상태 변형 ───
       스크롤 진행률에 따라 극 위치 · 씨앗 수 · 회전속도 lerp.
       상태는 Three.js 루프에서 읽어 fieldGroup / camera에 적용.
    ─── */
    (function () {
      var scrollRatio = 0;  /* 0 ~ 1 */
      var lerpRatio   = 0;  /* 부드러운 추종 */

      function updateScroll() {
        var docH = document.documentElement.scrollHeight - window.innerHeight;
        scrollRatio = docH > 0 ? window.scrollY / docH : 0;
      }
      window.addEventListener('scroll', updateScroll, { passive: true });
      updateScroll();

      /* Three.js 루프에 공유할 상태 객체 */
      window._fieldState = {
        get ratio() { return lerpRatio; }
      };

      /* lerp 루프 */
      (function lerpLoop() {
        lerpRatio += (scrollRatio - lerpRatio) * 0.04;
        requestAnimationFrame(lerpLoop);
      })();
    })();

    /* ─── Featured Article 로드 ─── */
    fetch('archive/index.json')
      .then(function(r) { return r.json(); })
      .then(function(posts) {
        if (!posts || !posts.length) return;
        var post = posts[0];
        var link = document.getElementById('featured-article');
        var issueNum = post.issue ? post.issue.replace('Issue ', '') : '00';
        link.href = 'archive/' + post.slug + '/';
        document.getElementById('featured-issue').textContent = 'ISSUE ' + issueNum;
        document.getElementById('featured-date').textContent   = post.date;
        document.getElementById('featured-title').textContent  = post.title;
        setTimeout(function() { link.classList.add('visible'); }, 200);
      })
      .catch(function() {
        var blk = document.querySelector('.fb--essay');
        if (blk) blk.style.display = 'none';
      });

    /* ─── FB 블록 스크롤 reveal ─── */
    (function () {
      var blocks = Array.from(document.querySelectorAll('.fb'));
      var activeIdx = -1;

      function updateActive() {
        var fieldMain = document.querySelector('.field-main');
        if (!fieldMain) return;
        var vh = window.innerHeight;
        var total = fieldMain.offsetHeight - vh;
        var sy = Math.max(0, window.scrollY);
        var n = blocks.length;
        var segH = total / n;
        var idx = Math.min(Math.floor(sy / segH), n - 1);

        if (idx === activeIdx) return; /* 변화 없으면 skip */
        activeIdx = idx;

        blocks.forEach(function (b, i) {
          var shouldShow = (i === idx) || (i === 0); /* brand 항상 */
          if (shouldShow) {
            b.classList.add('fb--visible');
          } else {
            b.classList.remove('fb--visible');
          }
        });

        /* essay-link */
        var essayLink = document.getElementById('featured-article');
        if (essayLink) {
          var essayBlock = document.querySelector('.fb--essay');
          var essayIdx = blocks.indexOf(essayBlock);
          if (idx === essayIdx) essayLink.classList.add('visible');
        }
      }

      window.addEventListener('scroll', updateActive, { passive: true });
      window.addEventListener('resize', updateActive);
      updateActive();
    })();
  </script>

</body>

</html>
